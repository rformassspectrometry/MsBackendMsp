<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MsBackendMsp">
<title>MsBackendMsp • MsBackendMsp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MsBackendMsp">
<meta property="og:description" content="MsBackendMsp">
<meta property="og:image" content="https://rformassspectrometry.github.io/MsBackendMsp/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MsBackendMsp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/MsBackendMsp.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/MsBackendMsp/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>MsBackendMsp</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/MsBackendMsp/blob/HEAD/vignettes/MsBackendMsp.Rmd" class="external-link"><code>vignettes/MsBackendMsp.Rmd</code></a></small>
      <div class="d-none name"><code>MsBackendMsp.Rmd</code></div>
    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><p><strong>Package</strong>: <em><a href="https://bioconductor.org/packages/3.17/MsBackendMsp" class="external-link">MsBackendMsp</a></em><br><strong>Authors</strong>: Neumann Steffen [aut] (<a href="https://orcid.org/0000-0002-7899-7192" class="external-link uri">https://orcid.org/0000-0002-7899-7192</a>), Johannes Rainer
[aut, cre] (<a href="https://orcid.org/0000-0002-6977-7147" class="external-link uri">https://orcid.org/0000-0002-6977-7147</a>), Michael Witting
[ctb] (<a href="https://orcid.org/0000-0002-1462-4426" class="external-link uri">https://orcid.org/0000-0002-1462-4426</a>)<br><strong>Compiled</strong>: Wed Jan 18 12:16:48 2023</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <em><a href="https://bioconductor.org/packages/3.17/Spectra" class="external-link">Spectra</a></em>
package provides a central infrastructure for the handling of Mass
Spectrometry (MS) data. The package supports interchangeable use of
different <em>backends</em> to import MS data from a variety of sources
(such as mzML files). The <code>MsBackendMsp</code> package adds support
for files in NIST MSP format which are frequently used to share spectra
libraries and hence enhances small compound annotation workflows using
the <code>Spectra</code> and <em><a href="https://bioconductor.org/packages/3.17/MetaboAnnotation" class="external-link">MetaboAnnotation</a></em>
packages <span class="citation">(Rainer et al. 2022)</span>. This
vignette illustrates the usage of the <code>MsBackendMsp</code> package
and how it can be used to import and export data in MSP file format.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To install this package, start <code>R</code> and enter:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"MsBackendMsp"</span><span class="op">)</span></span></code></pre></div>
<p>This will install this package and all eventually missing
dependencies.</p>
</div>
<div class="section level2">
<h2 id="importing-msms-data-from-msp-files">Importing MS/MS data from MSP files<a class="anchor" aria-label="anchor" href="#importing-msms-data-from-msp-files"></a>
</h2>
<p>The MSP file format allows to store MS/MS spectra (m/z and intensity
of mass peaks) along with additional annotations for each spectrum. A
single MSP file can thus contain a single or multiple spectra. Below we
load the package and define the file name of an MSP file which is
distributed with this package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsBackendMsp" class="external-link">MsBackendMsp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">nist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"spectrum2.msp"</span>, package <span class="op">=</span> <span class="st">"MsBackendMsp"</span><span class="op">)</span></span></code></pre></div>
<p>We next import the data into a <code>Spectra</code> object by
specifying in the constructor function the <em>backend</em> class which
can be used to read the data (in our case a
<code>MsBackendMsp</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">nist</span>, source <span class="op">=</span> <span class="fu"><a href="../reference/MsBackendMsp.html">MsBackendMsp</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Start data import from 1 files ... done</span></span></code></pre>
<p>With that we have now full access to all imported spectra variables
that can be listed with the <code>spectraVariables</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spectraVariables</span><span class="op">(</span><span class="va">sp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "msLevel"                 "rtime"                  </span></span>
<span><span class="co">##  [3] "acquisitionNum"          "scanIndex"              </span></span>
<span><span class="co">##  [5] "dataStorage"             "dataOrigin"             </span></span>
<span><span class="co">##  [7] "centroided"              "smoothed"               </span></span>
<span><span class="co">##  [9] "polarity"                "precScanNum"            </span></span>
<span><span class="co">## [11] "precursorMz"             "precursorIntensity"     </span></span>
<span><span class="co">## [13] "precursorCharge"         "collisionEnergy"        </span></span>
<span><span class="co">## [15] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span></span>
<span><span class="co">## [17] "isolationWindowUpperMz"  "name"                   </span></span>
<span><span class="co">## [19] "adduct"                  "INSTRUMENTTYPE"         </span></span>
<span><span class="co">## [21] "instrument"              "smiles"                 </span></span>
<span><span class="co">## [23] "inchikey"                "inchi"                  </span></span>
<span><span class="co">## [25] "formula"                 "PUBCHEMID"              </span></span>
<span><span class="co">## [27] "SOURCE"                  "COMMENT"                </span></span>
<span><span class="co">## [29] "Num.Peaks"</span></span></code></pre>
<p>Besides default spectra variables, such as <code>msLevel</code>,
<code>rtime</code>, <code>precursorMz</code>, we also have additional
spectra variables such as the <code>name</code> or <code>adduct</code>
that are additional data fields from the MSP file.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span><span class="op">$</span><span class="va">msLevel</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2 2</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span><span class="op">$</span><span class="va">name</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "3-Hydroxy-3-(2-(2-hydroxyphenyl)-2-oxoethyl)-1,3-dihydro-2H-indol-2-one"</span></span>
<span><span class="co">## [2] "5-(4-Ethoxybenzylidene)-2-(4-morpholinyl)-1,3-thiazol-4(5H)-one"</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span><span class="op">$</span><span class="va">adduct</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "[M+H]+" "[M+H]+"</span></span></code></pre>
<p>The NIST file format is however only loosely defined and variety of
<em>flavors</em> (or <em>dialects</em>) exist which define their own
data fields or use different names for the fields. The
<code>MsBackendMsp</code> supports data import/export from all MSP
format variations by defining and providing different mappings between
MSP data fields and spectra variables. Also user-defined mappings can be
used, which makes import from any MSP flavor possible. Pre-defined
mappings between MSP data fields and spectra variables (i.e. variables
within the <code>Spectra</code> object) are returned by the
<code>spectraVariableMapping</code> function.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="fu"><a href="../reference/MsBackendMsp.html">MsBackendMsp</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            name       accession         formula        inchikey          adduct </span></span>
<span><span class="co">##          "NAME"           "DB#"       "FORMULA"      "INCHIKEY" "PRECURSORTYPE" </span></span>
<span><span class="co">##       exactmass           rtime     precursorMz          adduct          smiles </span></span>
<span><span class="co">##     "EXACTMASS" "RETENTIONTIME"   "PRECURSORMZ" "PRECURSORTYPE"        "SMILES" </span></span>
<span><span class="co">##           inchi        polarity      instrument </span></span>
<span><span class="co">##         "INCHI"       "IONMODE"    "INSTRUMENT"</span></span></code></pre>
<p>The names of this <code>character</code> vector represent the spectra
variable names and the values of the vector the MSP data fields. Note
that by default, also all data fields for which no mapping is provided
are imported (with the field name being used as spectra variable
name).</p>
<p>This default mapping works well for MSP files from NIST or from other
tools such as MS-DIAL. MassBank of North America <a href="https://mona.fiehnlab.ucdavis.edu/" class="external-link">MoNA</a> however, uses a
slightly different format. Below we read the first 6 lines of a MSP file
from MoNA.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mona</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"minimona.msp"</span>, package <span class="op">=</span> <span class="st">"MsBackendMsp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">mona</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Name: Ritonavir"                      </span></span>
<span><span class="co">## [2] "Synon: $:00in-source"                 </span></span>
<span><span class="co">## [3] "DB#: MoNA000010"                      </span></span>
<span><span class="co">## [4] "InChIKey: NCDNCNXCDXHOMX-XGKFQTDJSA-N"</span></span>
<span><span class="co">## [5] "Instrument_type: Waters Synapt G2"    </span></span>
<span><span class="co">## [6] "Formula: C37H48N6O5S2"</span></span></code></pre>
<p>The first 6 lines from a NIST MSP file:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">nist</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "NAME: 3-Hydroxy-3-(2-(2-hydroxyphenyl)-2-oxoethyl)-1,3-dihydro-2H-indol-2-one"</span></span>
<span><span class="co">## [2] "PRECURSORMZ: 284.0917"                                                        </span></span>
<span><span class="co">## [3] "PRECURSORTYPE: [M+H]+"                                                        </span></span>
<span><span class="co">## [4] "INSTRUMENTTYPE: IT/ion trap"                                                  </span></span>
<span><span class="co">## [5] "INSTRUMENT: Thermo Finnigan LCQ Deca"                                         </span></span>
<span><span class="co">## [6] "SMILES: NA"</span></span></code></pre>
<p>MSP files with MoNA flavor use slightly different field names, that
are also not all upper case, and also additional fields are defined.
While it is possible to import MoNA flavored MSP files using the default
variable mapping that was used above, most of the spectra variables
would however not mapped correctly to the respective spectra variable in
the resulting <code>Spectra</code> object (e.g. the precursor m/z would
not be available with the expected spectra variable
<code>$precursorMz</code>).</p>
<p>The <code>spectraVariableMapping</code> provides however also the
mapping for MSP files with MoNA flavor.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="fu"><a href="../reference/MsBackendMsp.html">MsBackendMsp</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mona"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  name               synonym             accession </span></span>
<span><span class="co">##                "Name"               "Synon"                 "DB#" </span></span>
<span><span class="co">##              inchikey                adduct           precursorMz </span></span>
<span><span class="co">##            "InChIKey"      "Precursor_type"         "PrecursorMZ" </span></span>
<span><span class="co">##              polarity               formula             exactmass </span></span>
<span><span class="co">##            "Ion_mode"             "Formula"           "ExactMass" </span></span>
<span><span class="co">## collision_energy_text               msLevel </span></span>
<span><span class="co">##    "Collision_energy"       "Spectrum_type"</span></span></code></pre>
<p>Using this mapping in the data import will ensure that the fields get
correctly mapped.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_mona</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">mona</span>, source <span class="op">=</span> <span class="fu"><a href="../reference/MsBackendMsp.html">MsBackendMsp</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="fu"><a href="../reference/MsBackendMsp.html">MsBackendMsp</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mona"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Start data import from 1 files ... done</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_mona</span><span class="op">$</span><span class="va">precursorMz</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]       NA 189.1603 265.1188 265.1188 263.1031 263.1031 229.1552 312.1302</span></span>
<span><span class="co">##  [9] 525.4990 525.4990 525.4990 525.4990 525.4990 525.4990 525.4990 525.4990</span></span>
<span><span class="co">## [17] 525.4990 525.4990 525.4990 525.4990 539.5146 539.5146 539.5146 539.5146</span></span>
<span><span class="co">## [25] 539.5146 539.5146 539.5146 539.5146 539.5146 539.5146</span></span></code></pre>
<p>Note that in addition to the predefined variable mappings, it is also
possible to provide any user-defined variable mapping with the
<code>mapping</code> parameter thus enabling to import from MSP files
with a highly customized format.</p>
<p>Multiple values for a certain spectrum are represented as duplicated
fields in an MSP file. The <code>MsBackendMsp</code> supports also
import of such data. MoNA MSP files use for example multiple
<code>"Synon"</code> fields to list all synonyms of a compound. Below we
extract such values for two spectra within our <code>Spectra</code>
object from MoNA.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_mona</span><span class="op">[</span><span class="fl">29</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span><span class="op">$</span><span class="va">synonym</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] "$:00 ms2"                "$:05 30V CID"           </span></span>
<span><span class="co">## [3] "$:07 In-Silico-Spectrum" "$:00in-source"          </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] "$:00 ms2"                "$:05 30V CID"           </span></span>
<span><span class="co">## [3] "$:07 In-Silico-Spectrum" "$:00in-source"</span></span></code></pre>
<p>In addition to importing data from MSP files,
<code>MsBackendMsp</code> allows also to <strong>export</strong>
<code>Spectra</code> to files in MSP format. Below we export for example
the <code>Spectra</code> with data from MoNA to a temporary file, using
the default NIST MSP format.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmpf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/hidden_aliases.html" class="external-link">export</a></span><span class="op">(</span><span class="va">sp_mona</span>, backend <span class="op">=</span> <span class="fu"><a href="../reference/MsBackendMsp.html">MsBackendMsp</a></span><span class="op">(</span><span class="op">)</span>, file <span class="op">=</span> <span class="va">tmpf</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="fu"><a href="../reference/MsBackendMsp.html">MsBackendMsp</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">tmpf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "NAME: Ritonavir"                      </span></span>
<span><span class="co">## [2] "msLevel: MS2"                         </span></span>
<span><span class="co">## [3] "synonym: $:00in-source"               </span></span>
<span><span class="co">## [4] "DB#: MoNA000010"                      </span></span>
<span><span class="co">## [5] "INCHIKEY: NCDNCNXCDXHOMX-XGKFQTDJSA-N"</span></span>
<span><span class="co">## [6] "Instrument_type: Waters Synapt G2"</span></span></code></pre>
<p>Or export the <code>Spectra</code> with data in NIST MSP format to a
MSP file with MoNA flavor.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmpf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/hidden_aliases.html" class="external-link">export</a></span><span class="op">(</span><span class="va">sp</span>, backend <span class="op">=</span> <span class="fu"><a href="../reference/MsBackendMsp.html">MsBackendMsp</a></span><span class="op">(</span><span class="op">)</span>, file <span class="op">=</span> <span class="va">tmpf</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="fu"><a href="../reference/MsBackendMsp.html">MsBackendMsp</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mona"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">tmpf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Name: 3-Hydroxy-3-(2-(2-hydroxyphenyl)-2-oxoethyl)-1,3-dihydro-2H-indol-2-one"</span></span>
<span><span class="co">## [2] "Spectrum_type: MS2"                                                           </span></span>
<span><span class="co">## [3] "Ion_mode: Positive"                                                           </span></span>
<span><span class="co">## [4] "PrecursorMZ: 284.0917"                                                        </span></span>
<span><span class="co">## [5] "Precursor_type: [M+H]+"                                                       </span></span>
<span><span class="co">## [6] "INSTRUMENTTYPE: IT/ion trap"</span></span></code></pre>
<p>Thus, this could also be used to convert between MSP files with
different flavors.</p>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R Under development (unstable) (2023-01-11 r83598)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.1 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] MsBackendMsp_1.3.1  Spectra_1.9.6       ProtGenerics_1.29.1</span></span>
<span><span class="co">## [4] BiocParallel_1.33.9 S4Vectors_0.37.3    BiocGenerics_0.45.0</span></span>
<span><span class="co">## [7] BiocStyle_2.27.0   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] jsonlite_1.8.4      compiler_4.3.0      BiocManager_1.30.19</span></span>
<span><span class="co">##  [4] stringr_1.5.0       parallel_4.3.0      cluster_2.1.4      </span></span>
<span><span class="co">##  [7] jquerylib_0.1.4     IRanges_2.33.0      systemfonts_1.0.4  </span></span>
<span><span class="co">## [10] textshaping_0.3.6   yaml_2.3.6          fastmap_1.1.0      </span></span>
<span><span class="co">## [13] R6_2.5.1            knitr_1.41          MASS_7.3-58.1      </span></span>
<span><span class="co">## [16] bookdown_0.32       desc_1.4.2          rprojroot_2.0.3    </span></span>
<span><span class="co">## [19] bslib_0.4.2         rlang_1.0.6         cachem_1.0.6       </span></span>
<span><span class="co">## [22] stringi_1.7.12      xfun_0.36           MsCoreUtils_1.11.3 </span></span>
<span><span class="co">## [25] fs_1.5.2            sass_0.4.4          memoise_2.0.1      </span></span>
<span><span class="co">## [28] cli_3.6.0           pkgdown_2.0.7.9000  magrittr_2.0.3     </span></span>
<span><span class="co">## [31] digest_0.6.31       clue_0.3-63         lifecycle_1.0.3    </span></span>
<span><span class="co">## [34] vctrs_0.5.1         evaluate_0.20       glue_1.6.2         </span></span>
<span><span class="co">## [37] codetools_0.2-18    ragg_1.2.5          rmarkdown_2.19     </span></span>
<span><span class="co">## [40] purrr_1.0.1         tools_4.3.0         htmltools_0.5.4</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-rainer_modular_2022" class="csl-entry">
Rainer, Johannes, Andrea Vicini, Liesa Salzer, Jan Stanstrup, Josep M.
Badia, Steffen Neumann, Michael A. Stravs, et al. 2022. <span>“A
<span>Modular</span> and <span>Expandable</span> <span>Ecosystem</span>
for <span>Metabolomics</span> <span>Data</span> <span>Annotation</span>
in <span>R</span>.”</span> <em>Metabolites</em> 12 (2): 173. <a href="https://doi.org/10.3390/metabo12020173" class="external-link">https://doi.org/10.3390/metabo12020173</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Neumann Steffen, Johannes Rainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
